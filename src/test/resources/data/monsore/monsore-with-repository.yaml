version: 1
application:
  defaultLanguage: fr
  internationalizationName:
    fr: SOERE mon SOERE avec dépôt
    en: SOERE my SOERE with repository
  name: MONSORE
  version: 1
additionalFiles:
  fichiers:
    internationalizationName:
      fr: Fichiers
      en: Files
    format:
      nom:
        internationalizationName:
          fr: Nom
          en: Name
        checker:
          name: RegularExpression
          params:
            pattern: "[a-z]*"
      date:
        internationalizationName:
          fr: Date
          en: Date
        checker:
          name: Date
          params:
            pattern: "dd/MM/yyyy"
      age:
        internationalizationName:
          fr: Age
          en: Age
        checker:
          name: Integer
      poids:
        internationalizationName:
          fr: Poids
          en: Weight
        checker:
          name: Float
          params:
            required: false
      site:
        internationalizationName:
          fr: Site
          en: Place
        checker:
          name: Reference
          params:
            refType: mareferencesite
            required: true
  utilisateurs:
    internationalizationName:
      fr: Users
      en: User
    format:
      nom:
        internationalizationName:
          fr: Nom
          en: Name
        checker:
          name: RegularExpression
          params:
            pattern: "[a-z]*"
      prenom:
        internationalizationName:
          fr: Prénom
          en: Surname
        checker:
          name: RegularExpression
          params:
            pattern: "[a-z]*"

compositeReferences:
  macompositereferencesites:
    components:
      - reference: mareferencetypedesites
      - parentKeyColumn: tze_type_nom
        parentRecursiveKey: zet_chemin_parent
        reference: mareferencesite
  macompositereferenceprojet:
    components:
      - reference: mareferenceprojet
references:
  mareferenceespece:
    internationalizationName:
      fr: Espèces
      en: Species
    internationalizedColumns:
      esp_definition_fr:
        fr: esp_definition_fr
        en: esp_definition_en
    internationalizationDisplay:
      pattern:
        fr: '{esp_nom}'
        en: '{esp_nom}'
    keyColumns:
      - esp_nom
    columns:
      esp_nom: null
      esp_definition_fr: null
      esp_definition_en: null
      colonne_homonyme_entre_referentiels: null
  mareferenceprojet:
    internationalizationName:
      fr: Projet
      en: Project
    internationalizedColumns:
      nom_key:
        fr: nom_fr
        en: nom_en
      definition_fr:
        fr: definition_fr
        en: definition_en
    internationalizationDisplay:
      pattern:
        fr: '{nom_key}'
        en: '{nom_key}'
    keyColumns:
      - nom_key
    columns:
      nom_key: null
      nom_fr: null
      nom_en: null
      definition_fr: null
      definition_en: null
      colonne_homonyme_entre_referentiels: null
  mareferencesite:
    validations:
      typeSitesRef:
        internationalizationName:
          fr: référence au type de site
        checker:
          name: Reference
          params:
            refType: mareferencetypedesites
        columns: [ tze_type_nom ]
      siteParentRef:
        internationalizationName:
          fr: référence à la colonne parent
        checker:
          name: Reference
          params:
            refType: mareferencesite
            required: false
        columns: [ zet_chemin_parent ]
    keyColumns:
      - zet_chemin_parent
      - zet_nom_key
    internationalizationName:
      fr: Site
      en: Site
    internationalizedColumns:
      zet_nom_key:
        fr: zet_nom_fr
        en: zet_nom_en
      zet_desc_fr:
        fr: zet_desc_fr
        en: zet_desc_en
    internationalizationDisplay:
      pattern:
        fr: '{zet_nom_key}'
        en: '{zet_nom_key}'
    columns:
      tze_type_nom: null
      zet_nom_key: null
      zet_nom_fr: null
      zet_nom_en: null
      zet_desc_fr: null
      zet_desc_en: null
      zet_chemin_parent: null
  mareferencetheme:
    keyColumns:
      - nom_key
    internationalizationName:
      fr: Thème
      en: Thematic
    internationalizedColumns:
      nom_key:
        fr: nom_fr
        en: nom_en
      description_fr:
        fr: description_fr
        en: description_en
    internationalizationDisplay:
      pattern:
        fr: '{nom_key}'
        en: '{nom_key}'
    columns:
      nom_key: null
      nom_fr: null
      nom_en: null
      description_fr: null
      description_en: null
  mareferencetypedefichier:
    keyColumns:
      - nom_key
    internationalizationName:
      fr: Types de fichiers
      en: Files types
    internationalizedColumns:
      nom_key:
        fr: nom_fr
        en: nom_en
      description_fr:
        fr: description_fr
        en: description_en
    internationalizationDisplay:
      pattern:
        fr: '{nom_key}'
        en: '{nom_key}'
    columns:
      nom_key: null
      nom_fr: null
      nom_en: null
      description_fr: null
      description_en: null
  mareferencetypedesites:
    keyColumns:
      - tze_nom_key
    internationalizationName:
      fr: Types de sites
      en: Sites types
    internationalizedColumns:
      tze_nom_key:
        fr: tze_nom_fr
        en: tze_nom_en
      tze_definition_fr:
        fr: tze_definition_fr
        en: tze_definition_en
    internationalizationDisplay:
      pattern:
        fr: '{tze_nom_key}'
        en: '{tze_nom_key}'
    columns:
      tze_nom_key: null
      tze_nom_fr: null
      tze_nom_en: null
      tze_definition_fr: null
      tze_definition_en: null
  mareferencetypes_de_donnees_par_themes_de_sites_et_projet:
    internationalizationName:
      fr: Types de données par site et projet
      en: Data types by site and project
    internationalizationDisplay:
      pattern:
        fr: >-
          nom du projet: {nom du projet}, nom du site : {nom du site}, nom du
          thème : {nom du thème}, nom du type de données : {nom du type de
          données}
        en: >-
          projet name: {nom du projet}, site name : {nom du site}, theme name :
          {nom du thème}, data type name : {nom du type de données}
    validations:
      validationprojet:
        internationalizationName:
          fr: référence au projet
        checker:
          name: Reference
          params:
            refType: mareferenceprojet
        columns: [ nom du projet ]
      validationsites:
        internationalizationName:
          fr: référence au site
        checker:
          name: Reference
          params:
            refType: mareferencesite
        columns: [ nom du site ]
      validationthemes:
        internationalizationName:
          fr: référence au theme
        checker:
          name: Reference
          params:
            refType: mareferencetheme
        columns: [ nom du thème ]
      validationdatatype:
        internationalizationName:
          fr: test
        columns: [ nom du type de données ]
        checker:
          name: GroovyExpression
          params:
            groovy:
              expression: >
                String datatype = "montypededonnees"+datum.get("nom du type de données"); 
                return application.getDataType().contains(datatype);
    keyColumns:
      - nom du projet
      - nom du site
      - nom du thème
      - nom du type de données
    columns:
      nom du projet: null
      nom du site: null
      nom du thème: null
      nom du type de données: null
  mareferenceunites:
    keyColumns:
      - nom_key
    internationalizationName:
      fr: Unités
      en: Units
    internationalizedColumns:
      code_key:
        fr: code_fr
        en: code_en
      nom_key:
        fr: nom_fr
        en: nom_en
    internationalizationDisplay:
      pattern:
        fr: '{nom_key} ({code_key})'
        en: '{nom_key} ({code_key})'
    columns:
      code_key: null
      code_fr: null
      code_en: null
      nom_key: null
      nom_fr: null
      nom_en: null
  mareferencevaleurs_qualitatives:
    keyColumns:
      - nom_key
      - valeur_key
    internationalizationName:
      fr: Valeurs qualitatives
      en: Qualitative values
    internationalizedColumns:
      nom_key:
        fr: nom_fr
        en: nom_en
      valeur_key:
        fr: valeur_fr
        en: valeur_en
    internationalizationDisplay:
      pattern:
        fr: '{valeur_key}'
        en: '{valeur_key}'
    columns:
      nom_key: null
      nom_fr: null
      nom_en: null
      valeur_key: null
      valeur_fr: null
      valeur_en: null
  mareferencevariables:
    keyColumns:
      - nom_key
    internationalizationName:
      fr: Variables
      en: Variables
    internationalizedColumns:
      nom_key:
        fr: nom_fr
        en: nom_en
      definition_fr:
        fr: definition_fr
        en: definition_en
    internationalizationDisplay:
      pattern:
        fr: '{nom_key}'
        en: '{nom_key}'
    columns:
      nom_key: null
      nom_fr: null
      nom_en: null
      definition_fr: null
      definition_en: null
      isQualitative: null
  mareferencevariables_et_unites_par_types_de_donnees:
    validations:
      variableRef:
        internationalizationName:
          fr: référence à la variable
        checker:
          name: Reference
          params:
            refType: mareferencevariables
        columns: [ nom de la variable ]
      uniteRef:
        internationalizationName:
          fr: référence à l'unité'
        checker:
          name: Reference
          params:
            refType: mareferenceunites
        columns: [ nom de l'unité ]
      checkDatatype:
        internationalizationName:
          fr: test
        columns: [ nom du type de données ]
        checker:
          name: GroovyExpression
          params:
            groovy:
              expression: >
                String datatype = "montypededonnees"+datum.get("nom du type de données"); 
                return application.getDataType().contains(datatype);
    keyColumns:
      - nom du type de données
      - nom de la variable
    internationalizationName:
      fr: Variables et unités par type de données
      en: Variables and units by data type
    internationalizationDisplay:
      pattern:
        fr: >-
          nom du type de données : {nom du type de données}, nom de la variable
          : {nom de la variable}, : nom de l'unité {nom de l'unité}
        en: >-
          datatype name : {nom du type de données}, variable name : {nom de la
          variable}, : unit name {nom de l'unité}
    columns:
      nom du type de données: null
      nom de la variable: null
      nom de l'unité: null
dataTypes:
  montypededonneespiegeageenmontee:
    internationalizationName:
      fr: Piégeage en Montée
      en: Trap in ascent
    repository:
        filePattern: "([^_]*_[^_]*)_(.*)_(.*)_(.*).csv"
        authorizationScope: 
          localization: 2
          projet: 1
        startDate: 
          token: 3
        endDate: 
          token: 4
    data:
      mavariableprojet:
        components:
          lacomposantenomduprojet:
            checker:
              name: Reference
              params:
                refType: mareferenceprojet
      mavariablesite:
        components:
          lacomposantebassin: null
          lacomposanteplateforme: null
          lacomposantechemin:
            defaultValue:
              expression: >
                return references.get("mareferencesite")
                .find{it.getRefValues().get("zet_chemin_parent").equals(datum.mavariablesite.lacomposantebassin)
                &&
                it.getRefValues().get("zet_nom_key").equals(datum.mavariablesite.lacomposanteplateforme)}
                .getHierarchicalKey();
              references:
                - mareferencesite
            checker:
              name: Reference
              params:
                refType: mareferencesite
        computedComponents:
          lacomposanteclaculeesite_bassin:
            computation:
              expression: >
                return references.get("mareferencesite")
                .find{it.getNaturalKey().equals(datum.mavariablesite.lacomposantebassin)}
                .getHierarchicalKey();
              references:
                - mareferencesite
            checker:
              name: Reference
              params:
                refType: mareferencesite
      mavariabledate:
        components:
          lacomposantejour:
            checker:
              name: Date
              params:
                pattern: dd/MM/yyyy
                required: null
      mavariableespece:
        components:
          lacomposantenomespece:
            checker:
              name: Reference
              params:
                refType: mareferenceespece
      mavariableCouleur:
        components:
          lecomposantecouleur:
            checker:
              name: Reference
              params:
                refType: mareferencevaleurs_qualitatives
          lacomposanteunit:
            defaultValue:
              expression: return "sans_unite"
            checker:
              name: Reference
              params:
                refType: mareferenceunites
                required: null
      mavariableNombre d'individus:
        components:
          lacomposantenombre:
            defaultValue:
              expression: return 0
            checker:
              name: Integer
              params:
                required: null
          lacomposanteunit:
            defaultValue:
              expression: return "sans_unite"
            checker:
              name: Reference
              params:
                refType: mareferenceunites
                required: null
    validations:
      validationdesunitesdecouleur:
        internationalizationName:
          fr: vérifie l'unité de la couleur des individus
        checker:
          name: GroovyExpression
          params:
            groovy:
              expression: >
                String datatype = "piegeageenmontee";
                  String variable = "mavariableCouleur";
                  String codeVariable = "couleur_des_individus";
                  String component = "lacomposanteunit";
                  println (datatype)
                  println (variable)
                  println (codeVariable)
                  println (component)
                  return referencesValues.get("mareferencevariables_et_unites_par_types_de_donnees") //montypededonneespiegeageenmontee
                  .findAll{it.get("nom du type de données").equals(datatype)}
                  .find{it.get("nom de la variable").equals(codeVariable)}
                  .get("nom de l'unité").equals(datum.get(variable).get(component));
              references:
                - mareferencevariables_et_unites_par_types_de_donnees
      validationdesunitesindividus:
        internationalizationName:
          fr: vérifie l'unité du nombre d'individus
        checker:
          name: GroovyExpression
          params:
            groovy:
              expression: >
                String datatype = "piegeageenmontee"; 
                String variable = "mavariableNombre d'individus";  
                String codeVariable = "nombre_d_individus";  
                String component = "lacomposanteunit";  
                return referencesValues.get("mareferencevariables_et_unites_par_types_de_donnees") 
                        .findAll{it.get("nom du type de données").equals(datatype)} 
                .find{it.get("nom de la variable").equals(codeVariable)} 
                .get("nom de l'unité").equals(datum.get(variable).get(component));
              references:
                - mareferencevariables_et_unites_par_types_de_donnees
    format:
      headerLine: 4
      firstRowLine: 5
      columns:
        - header: projet
          boundTo:
            variable: mavariableprojet
            component: lacomposantenomduprojet
        - header: site
          boundTo:
            variable: mavariablesite
            component: lacomposantebassin
        - header: plateforme
          boundTo:
            variable: mavariablesite
            component: lacomposanteplateforme
        - header: date
          boundTo:
            variable: mavariabledate
            component: lacomposantejour
        - header: espece
          boundTo:
            variable: mavariableespece
            component: lacomposantenomespece
        - header: Couleur des individus
          boundTo:
            variable: mavariableCouleur
            component: lecomposantecouleur
        - header: Nombre d'individus
          boundTo:
            variable: mavariableNombre d'individus
            component: lacomposantenombre
    authorization:
      authorizationScopes:
        projet:
          internationalizationName:
            fr: Projet
            en: Project
          variable: mavariableprojet
          component: lacomposantenomduprojet
        localization:
          internationalizationName:
            fr: Localisation
            en: Localization
          variable: mavariablesite
          component: lacomposantechemin
      timeScope:
        variable: mavariabledate
        component: lacomposantejour
      dataGroups:
        mongroupedevariablereferentiel:
          internationalizationName:
            fr: Référentiels
            en: Repositories
          label: Référentiel
          data:
            - mavariableprojet
            - mavariablesite
            - mavariabledate
            - mavariableespece
        mongroupedevariablequalitatif:
          internationalizationName:
            fr: Qualitatif
            en: Qualitative
          label: Données qualitatives
          data:
            - mavariableCouleur
        mongroupedevariablequantitatif:
          internationalizationName:
            fr: Quantitatif
            en: Quantitative
          label: Données quantitatives
          data:
            - mavariableNombre d'individus
    uniqueness:
      - variable: mavariableprojet
        component: lacomposantenomduprojet
      - variable: mavariablesite
        component: lacomposantechemin
      - variable: mavariabledate
        component: lacomposantejour
      - variable: mavariableespece
        component: lacomposantenomespece